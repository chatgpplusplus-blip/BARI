@page "/documentaciones"

<PageTitle>Documentaciones</PageTitle>

<section class="page-card">
    <h2>Documentaciones</h2>
    <p>
        En esta página se concentrará la documentación oficial del laboratorio:
        fichas de reactivos, manuales, protocolos y formularios.
    </p>
    <LaboratorioSelector />
</section>




<section id="asignaturas" class="page-card" style="margin-top:1.5rem;">
    <h3>Documentación para asignaturas</h3>
    <p class="section-intro">
        Se listan las asignaturas disponibles. Cada una enlaza a su documentación de laboratorio.
    </p>
    <div class="assign-grid">
        @foreach (var asignatura in asignaturas)
        {
            <article class="assign-item" @key="asignatura.Id">
                <div>
                    <h4>@asignatura.Nombre</h4>
                    <span class="muted">@asignatura.Codigo</span>
                </div>
                <NavLink class="btn-link" href="@($"/documentacion/{asignatura.Slug}/laboratorios")">
                    Ver documentación
                </NavLink>
            </article>
        }
    </div>

    <details open class="guide-block">
        <summary>Sublista de experiencias por asignatura</summary>
        <ul class="guide-list">
            <li>Experiencia 1 · Materiales usados · Equipos usados</li>
            <li>Experiencia 2 · Procedimientos · Precauciones</li>
            <li>Experiencia 3 · Observaciones · Tiempo estimado</li>
        </ul>
    </details>
</section>

<section id="instituciones" class="page-card" style="margin-top:1.5rem;">
    <h3>Documentación de instituciones</h3>
    <p class="section-intro">
        Normativas y referencias externas para cada asignatura: pictogramas, consejos de prudencia,
        peligros, CAS y otras guías oficiales.
    </p>
    <details open class="guide-block">
        <summary>Subcategorías oficiales</summary>
        <ul class="guide-list">
            <li>Pictogramas (GHS)</li>
            <li>Consejos de prudencia (P-codes)</li>
            <li>Peligros (H-codes)</li>
            <li>CAS y catálogos externos</li>
        </ul>
    </details>
    <div class="assign-grid">
        @foreach (var asignatura in asignaturas)
        {
            <article class="assign-item" @key="asignatura.Id">
                <div>
                    <h4>@asignatura.Nombre</h4>
                    <span class="muted">@asignatura.Codigo</span>
                </div>
                <div class="link-stack">
                    <NavLink class="btn-link" href="@($"/documentacion/{asignatura.Slug}/oficial")">Ver resumen</NavLink>
                    <NavLink class="btn-link" href="@($"/documentacion/{asignatura.Slug}/oficial/pictogramas")">Pictogramas</NavLink>
                    <NavLink class="btn-link" href="@($"/documentacion/{asignatura.Slug}/oficial/consejos")">Consejos de prudencia</NavLink>
                    <NavLink class="btn-link" href="@($"/documentacion/{asignatura.Slug}/oficial/peligros")">Peligros</NavLink>
                    <NavLink class="btn-link" href="@($"/documentacion/{asignatura.Slug}/oficial/cas")">CAS</NavLink>
                </div>
            </article>
        }
    </div>

    <div class="table-wrap" style="margin-top:1rem;">
        <table>
            <thead>
                <tr>
                    <th>Normativa</th>
                    <th>Descripción</th>
                    <th>Items asociados</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>GHS</td>
                    <td>Pictogramas de seguridad</td>
                    <td>9 pictogramas</td>
                </tr>
                <tr>
                    <td>P-Codes</td>
                    <td>Consejos de prudencia</td>
                    <td>Catálogo oficial</td>
                </tr>
                <tr>
                    <td>H-Codes</td>
                    <td>Frases de peligro</td>
                    <td>Catálogo oficial</td>
                </tr>
            </tbody>
        </table>
    </div>
</section>

<section id="upsa" class="page-card" style="margin-top:1.5rem;">
    <h3>Documentación del laboratorio (UPSA)</h3>
    <p class="section-intro">
        Manuales, procedimientos y reglamentos internos por asignatura.
    </p>
    <details open class="guide-block">
        <summary>Subcategorías internas</summary>
        <ul class="guide-list">
            <li>Manuales</li>
            <li>Procedimientos</li>
            <li>Protocolos internos</li>
        </ul>
    </details>
    <div class="assign-grid">
        @foreach (var asignatura in asignaturas)
        {
            <article class="assign-item" @key="asignatura.Id">
                <div>
                    <h4>@asignatura.Nombre</h4>
                    <span class="muted">@asignatura.Codigo</span>
                </div>
                <div class="link-stack">
                    <NavLink class="btn-link" href="@($"/documentacion/{asignatura.Slug}/upsa")">Ver resumen</NavLink>
                    <NavLink class="btn-link" href="@($"/documentacion/{asignatura.Slug}/upsa/manuales")">Manuales</NavLink>
                    <NavLink class="btn-link" href="@($"/documentacion/{asignatura.Slug}/upsa/procedimientos")">Procedimientos</NavLink>
                </div>
            </article>
        }
    </div>

    <div class="table-wrap" style="margin-top:1rem;">
        <table>
            <thead>
                <tr>
                    <th>Documento</th>
                    <th>Tipo</th>
                    <th>Asignatura</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Manual de seguridad UPSA</td>
                    <td>Manual</td>
                    <td>Química General</td>
                    <td>Vigente</td>
                </tr>
                <tr>
                    <td>Procedimiento de residuos</td>
                    <td>Procedimiento</td>
                    <td>Química Analítica</td>
                    <td>Revisión anual</td>
                </tr>
                <tr>
                    <td>Reglamento interno laboratorio</td>
                    <td>Protocolo</td>
                    <td>Química Inorgánica</td>
                    <td>Vigente</td>
                </tr>
            </tbody>
        </table>
    </div>
</section>

@code {
    [Inject] private PgCrud Crud { get; set; } = default!;

    private readonly List<AsignaturaView> asignaturas = new();
    private string? loadError;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            Crud.UseSheet("asignaturas");
            var rows = await Crud.ReadAllAsync();
            asignaturas.Clear();

            foreach (var row in rows)
            {
                var id = row.GetValueOrDefault("asignatura_id") ?? "";
                var nombre = row.GetValueOrDefault("nombre") ?? "";
                var codigo = row.GetValueOrDefault("codigo_clase") ?? "";
                var slug = Slugify(!string.IsNullOrWhiteSpace(codigo) ? codigo : nombre);

                if (!string.IsNullOrWhiteSpace(id) && !string.IsNullOrWhiteSpace(nombre))
                {
                    asignaturas.Add(new AsignaturaView(id, nombre, codigo, slug));
                }
            }
        }
        catch (Exception ex)
        {
            loadError = ex.Message;
        }

        if (asignaturas.Count == 0)
        {
            asignaturas.Add(new AsignaturaView("quimica-general", "Química General", "QUI-101", "quimica-general"));
        }
    }

    private static string Slugify(string value)
    {
        var lower = value.ToLowerInvariant();
        var normalized = System.Text.RegularExpressions.Regex.Replace(lower, @"[^a-z0-9]+", "-");
        return normalized.Trim('-');
    }

    private sealed record AsignaturaView(string Id, string Nombre, string Codigo, string Slug);
}

<style>
    .section-intro { color:#4b5563; margin-bottom:0.75rem; }
    .menu-grid {
        display:grid;
        gap:1rem;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    .menu-item {
        border:1px solid #e5e7eb;
        border-radius:0.8rem;
        padding:0.9rem 1rem;
        background:#fff;
    }
    .menu-item summary {
        cursor:pointer;
        display:flex;
        flex-direction:column;
        gap:0.25rem;
        font-weight:600;
        color:#0b2a68;
    }
    .menu-links {
        display:flex;
        flex-direction:column;
        gap:0.4rem;
        margin-top:0.6rem;
    }
    .type-grid {
        display:grid;
        gap:1rem;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    .type-item {
        border:1px solid #e5e7eb;
        border-radius:0.8rem;
        padding:0.9rem 1rem;
        background:#fff;
        display:flex;
        flex-direction:column;
        gap:0.6rem;
    }
    .type-item h4 { margin:0 0 0.2rem; color:#0b2a68; }
    .error-note { color:#b91c1c; font-size:0.9rem; margin:0 0 0.75rem; }
    .guide-block { margin:0.75rem 0; }
    .guide-block summary { cursor:pointer; font-weight:600; color:#0b2a68; }
    .guide-list { margin:0.4rem 0 0; padding-left:1.2rem; color:#374151; }
    .guide-list li { margin:0.35rem 0; }
    .table-wrap { overflow-x:auto; }
    table { width:100%; border-collapse:collapse; background:#fff; }
    th, td { padding:0.6rem; border-bottom:1px solid #e5e7eb; text-align:left; }
    th { background:#f3f4f6; font-weight:600; }
    .assign-grid {
        display:grid;
        gap:1rem;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    .assign-item {
        border:1px solid #e5e7eb;
        border-radius:0.8rem;
        padding:0.9rem 1rem;
        background:#f9fafb;
        display:flex;
        flex-direction:column;
        gap:0.6rem;
    }
    .assign-item h4 { margin:0 0 0.2rem; color:#0b2a68; }
    .muted { color:#6b7280; font-size:0.85rem; }
    .btn-link {
        display:inline-flex;
        width:max-content;
        padding:0.35rem 0.6rem;
        border-radius:0.5rem;
        background:#0b2a68;
        color:#fff;
        text-decoration:none;
        font-size:0.85rem;
    }
    .btn-link:hover { background:#143a84; }
    .link-stack { display:flex; flex-direction:column; gap:0.35rem; }
</style>
