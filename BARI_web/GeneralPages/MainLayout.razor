@inherits LayoutComponentBase
@implements IDisposable
@inject NavigationManager Nav

<div class="bari-layout @(menuOpen ? "menu-open" : "")">
    <header class="bari-topbar">
        <button class="bari-hamburger"
                type="button"
                @onclick="ToggleMenu"
                aria-label="Abrir/Cerrar menú">
            ☰
        </button>

        <div class="bari-brand">
            <img class="bari-logo"
                 src="https://vc4a.com/wp-content/uploads/2022/06/198068246_2916680591924255_5728041621538232491_n.jpg"
                 alt="Logo UPSA" />
            <div class="bari-brand-text">
                <span class="bari-title">BARI</span>
                <span class="bari-subtitle">Inventario de Laboratorios · UPSA</span>
            </div>
        </div>

        <div class="bari-topbar-meta">
            <span class="bari-badge">Laboratorio base: Química</span>
        </div>
    </header>

    <div class="bari-shell">
        <aside class="bari-sidenav" aria-label="Menú lateral">

            <NavLink class="bari-navbtn" href="/" Match="NavLinkMatch.All">
                <span class="bari-navtext">INICIO</span>
            </NavLink>
            <small class="bari-hint">Panel principal del inventario</small>

            <div class="bari-search">
                <label class="bari-search-label">BUSCAR</label>
                <input @bind="searchText" class="bari-search-input" placeholder="Escribe aquí (próximamente)" />
            </div>

            <div class="bari-navsection">MÓDULOS</div>

            <nav class="bari-nav" aria-label="Navegación">
                <NavLink class="bari-navbtn" href="/baribot"><span class="bari-navtext">BARI BOT</span></NavLink>
                <NavLink class="bari-navbtn" href="/documentaciones"><span class="bari-navtext">DOCUMENTACIONES</span></NavLink>
                <NavLink class="bari-navbtn" href="/areas"><span class="bari-navtext">ÁREAS</span></NavLink>
                <NavLink class="bari-navbtn" href="/contenidos"><span class="bari-navtext">ASIGNATURAS, CLASES Y EXPERIENCIAS</span></NavLink>

                <div class="bari-navsection">INVENTARIO</div>

                <NavLink class="bari-navbtn" href="/inventario-materiales"><span class="bari-navtext">INVENTARIO MATERIALES</span></NavLink>
                <NavLink class="bari-navbtn" href="/inventario-equipo"><span class="bari-navtext">INVENTARIO EQUIPO</span></NavLink>
                <NavLink class="bari-navbtn" href="/inventario-sustancias"><span class="bari-navtext">INVENTARIO SUSTANCIAS</span></NavLink>
                <NavLink class="bari-navbtn" href="/inventario-instalaciones"><span class="bari-navtext">INSTALACIONES</span></NavLink>
                <NavLink class="bari-navbtn" href="/inventario-mesones"><span class="bari-navtext">MESONES</span></NavLink>
                <NavLink class="bari-navbtn" href="/informacion-tecnica"><span class="bari-navtext">DATOS TÉCNICOS</span></NavLink>
            </nav>
        </aside>
        <div class="bari-overlay" @onclick="CloseMenu" aria-hidden="true"></div>

        <main class="bari-main">
            @Body
        </main>
    </div>
</div>

@code {
    private bool menuOpen = false;
    private string? searchText;

    protected override void OnInitialized()
    {
        Nav.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, Microsoft.AspNetCore.Components.Routing.LocationChangedEventArgs e)
    {
        menuOpen = false;
        InvokeAsync(StateHasChanged);
    }

    private void ToggleMenu() => menuOpen = !menuOpen;
    private void CloseMenu() => menuOpen = false;

    public void Dispose()
    {
        Nav.LocationChanged -= OnLocationChanged;
    }
}
